# üöÄ –ë—ã—Å—Ç—Ä–∞—è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase Database

## ‚ö†Ô∏è –í–ê–ñ–ù–û: –í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ!

### –®–∞–≥ 1: –°–æ–∑–¥–∞–π—Ç–µ –¢–∞–±–ª–∏—Ü—ã (–°–ù–ê–ß–ê–õ–ê!)

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Supabase Dashboard**: https://supabase.com/dashboard
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç: `fhdtvadviuvxahsgrqyz`
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: **SQL Editor** ‚Üí **New query**
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å SQL –∏–∑ —Ñ–∞–π–ª–∞:
   ```bash
   cat /app/supabase/migrations.sql
   ```
5. –í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor –∏ –Ω–∞–∂–º–∏—Ç–µ **Run**

**–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç:**
- ‚úÖ –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã (users, swipes, matches, messages, –∏ —Ç.–¥.)
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ –§—É–Ω–∫—Ü–∏–∏ –∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã
- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–∏—è (PostGIS, uuid-ossp, pg_trgm)

### –®–∞–≥ 2: –ü—Ä–∏–º–µ–Ω–∏—Ç–µ RLS –∏ Security Fixes (–ü–û–¢–û–ú!)

1. –í —Ç–æ–º –∂–µ **SQL Editor** —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ SQL –∏–∑ —Ñ–∞–π–ª–∞:
   ```bash
   cat /app/supabase/fix_rls_and_policies.sql
   ```
3. –í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor –∏ –Ω–∞–∂–º–∏—Ç–µ **Run**

**–≠—Ç–æ –∏—Å–ø—Ä–∞–≤–∏—Ç:**
- ‚úÖ –í–∫–ª—é—á–∏—Ç RLS –Ω–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
- ‚úÖ –°–æ–∑–¥–∞—Å—Ç –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ –£–±–µ—Ä–µ—Ç Security Definer views

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –†–µ–∑—É–ª—å—Ç–∞—Ç

1. **Database** ‚Üí **Advisors** - –≤—Å–µ –æ—à–∏–±–∫–∏ –¥–æ–ª–∂–Ω—ã –∏—Å—á–µ–∑–Ω—É—Ç—å
2. **Table Editor** - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∏–¥–Ω—ã –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
3. **Authentication** ‚Üí **Policies** - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∏–¥–Ω—ã –ø–æ–ª–∏—Ç–∏–∫–∏ RLS

### –®–∞–≥ 4: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ù–∞–∂–º–∏—Ç–µ "–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç"
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É
4. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å! ‚úÖ

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ú–µ—Ç–æ–¥ (—á–µ—Ä–µ–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª)

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ psql:

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ Supabase
psql "postgresql://postgres:[YOUR-PASSWORD]@db.fhdtvadviuvxahsgrqyz.supabase.co:5432/postgres"

# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏
\i /app/supabase/migrations.sql
\i /app/supabase/fix_rls_and_policies.sql
```

## –ü—Ä–æ–±–ª–µ–º—ã?

### –û—à–∏–±–∫–∞: "relation already exists"
–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ! –ü—Ä–æ—Å—Ç–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–∏ –æ—à–∏–±–∫–∏, –ø—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.

### –û—à–∏–±–∫–∞: "permission denied"
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Service Role key, –∞ –Ω–µ Anon key.

### –¢–∞–±–ª–∏—Ü—ã –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (uuid-ossp, postgis, pg_trgm)
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ—Å—Ç—Ä–æ—á–Ω–æ, –µ—Å–ª–∏ –µ—Å—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏

## –ü–æ—Å–ª–µ –£—Å–ø–µ—à–Ω–æ–π –ù–∞—Å—Ç—Ä–æ–π–∫–∏

‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
‚úÖ RLS –≤–∫–ª—é—á–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ –í—Å–µ API endpoints –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

**–ú–æ–∂–µ—Ç–µ –Ω–∞—á–∏–Ω–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ!** üéâ
